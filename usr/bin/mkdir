--[[
	Custom mkdir command, which checks which user is logged in
	This will not allow normal users to make a directory under their
	home directory.
]]

function m(d)
	local r = false
	local falseDir = false
	local inhome = true
	if _G.currentUsr ~= "root" then
		r = false
	else
		r = true
	end
	local a, b = string.find(d, "//")
	if a then
		falseDir = true
	end
	local a, b = string.find(_G.currentDir, "/usr/".._G.currentUsr.."/home/")
	if r == false and a == nil then
		inhome = false
	end
	
	if r == false and falseDir == false and inhome == true then
		local a, b = string.find(d, "/")
		if a == 1 then
			--d = string.gsub(d, "/", "", 1)
			local col = term.getTextColor()
			term.setTextColor(colors.red)
			print("You have no privileges.")
			term.setTextColor(col)
		end
		local a, b = string.find(d, "../../")
		if a == 1 then
			--d = string.gsub(d, "/", "", 1)
			local col = term.getTextColor()
			term.setTextColor(colors.red)
			print("You have no privileges.")
			term.setTextColor(col)
		end
		local a, b = string.find(d, "../")
		if a == 1 then
			--d = string.gsub(d, "/", "", 1)
			local col = term.getTextColor()
			term.setTextColor(colors.red)
			print("You have no privileges.")
			term.setTextColor(col)
		end
		fs.makeDir(_G.currentDir..d)
		return true
	elseif r == true and falseDir == false then
		local a, b = string.find(d, "/")
		if a == 1 then
			fs.makeDir(d)
			return true
		else
			fs.makeDir(_G.currentDir..d)
			return true
		end
	elseif falseDir == true then
		local col = term.getTextColor()
		term.setTextColor(colors.red)
		print("Invalid path!")
		term.setTextColor(col)
		return false
	elseif inhome == false and r == false then
		local col = term.getTextColor()
		term.setTextColor(colors.red)
		print("You have no privileges.")
		term.setTextColor(col)
		return false
	else
		print("User not found.")
	end
end


local tArgs = {...}

if #tArgs < 1 or #tArgs > 1 then
	print("Usage:")
	print("		mkdir <folderName>")
else
	m(tArgs[1])
end