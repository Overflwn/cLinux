--[[
    cLinux Bootloader

    WIP

  AUTHOR: Piorjade
]]

local function string_rep(sStr, nAmount)
  for i=1, nAmount do
    sStr = sStr..sStr
  end
  return sStr
end

-- Setup

--List files in /boot and filter invalid files out
local listOfImages = fs.list("/boot/")
local listToRemove = {}
for each, entry in ipairs(listOfImages) do
  if string.sub(entry, #entry-5) == ".cefi" then
    listOfImages[each] = string.sub(entry, 1, #entry-6)
  else
    table.insert(listToRemove, each)
  end
end

for each, entry in ipairs(listToRemove) do
  table.remove(listOfImages, entry)
end

local function redraw()
  term.setBackgroundColor(colors.black)
  term.setTextColor(colors.white)
  term.clear()
  for i=1, #listOfImages do
    print(tostring(i)..") "..listOfImages[i])
  end
  print(string_rep("-", 51))
  term.write("Selection: ")
end

redraw()
local sInput
while true do
  sInput = read()
  local nSelection = tonumber(sInput)
  if nSelection >= 1 and nSelection <= #listOfImages then
    shell.run("/boot/"..listOfImages[nSelection]..".cefi")
  end
end
